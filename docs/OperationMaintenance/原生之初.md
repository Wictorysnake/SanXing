# åŸç”Ÿä¹‹åˆ

å…¶å®å°±æ˜¯æœ¬ä»“åº“çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦è®°å½•å‘¢ï¼Ÿå› ä¸ºåœ¨æ­å»ºçš„è¿‡ç¨‹ä¸­å‘ç°ç…§ç€å®˜ç½‘åŠç½‘ä¸Šç°æœ‰çš„æ•™ç¨‹ï¼Œæœ€ç»ˆå¹¶ä¸èƒ½è¾¾åˆ°èƒ½å¤Ÿè¿è¡Œå¹¶éƒ¨ç½²æˆåŠŸçš„ç»“æœã€‚æœ¬æ–‡æ¡£å°±æ˜¯ä¸ºäº†å¸®åŠ©å’Œæˆ‘ä¸€æ ·é‡åˆ°è¯¥é—®é¢˜çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿçš„è§£å†³é—®é¢˜è€Œå­˜åœ¨çš„ã€‚å› ä¸ºè¯¥ä»“åº“æ˜¯åŸºäº <code>vuepress</code> + <code>Github Pages</code> æ­å»ºçš„ä¸ªäººåšå®¢ï¼Œå› æ­¤æœ¬æ–‡å°†åˆ†ä¸ºä¸¤æ­¥å®ç°ï¼Œç¬¬ä¸€æ­¥æ˜¯æ­å»º <code>vuepress</code> çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œç¬¬äºŒæ­¥æ˜¯é…åˆ<code>Github Pages</code>å®ç°çº¿ä¸Šçš„éƒ¨ç½²ã€‚

## 1. æ­å»ºæœ¬åœ°å¼€å‘ç¯å¢ƒ

### 1.1 å®‰è£… Node.js

é¦–å…ˆéœ€è¦å®‰è£… Node.jsï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥ä¸Šå®˜ç½‘ä¸‹è½½å®‰è£…å³å¯ã€‚

### 1.2 åˆå§‹åŒ–æœ¬åœ°é¡¹ç›®

é¦–å…ˆå¾—æœ‰ä¸ªæœ¬åœ°é¡¹ç›®ï¼Œç”¨äºå­˜æ”¾åšå®¢çš„æºæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥åœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åˆ›å»ºæ–‡ä»¶å¤¹
mkdir vuepress-blog
# è¿›å…¥æ–‡ä»¶å¤¹
cd vuepress-blog
# åˆå§‹åŒ–é¡¹ç›®
npm init -y
```

### 1.3 å®‰è£… vuepress

é€šè¿‡ <code>npm</code>(or ä½ ä¹ æƒ¯çš„å…¶ä»–åŒ…ä¾èµ–å®‰è£…å·¥å…·) å®‰è£… <code>vuepress</code>ï¼š

```bash
npm install -D vuepress
or
yarn add -D vuepress
or
pnpm add -D vuepress
```

### 1.4 æ„é€ ç›®å½•ç»“æ„

æ ¹æ®<code>vuepress</code>[å®˜ç½‘](https://vuepress.vuejs.org/)çš„æŒ‡å—ï¼Œåˆ›å»º <code>docs</code>ç›®å½•ï¼Œå¹¶åˆ›å»ºç¬¬ä¸€ç¯‡æ–‡æ¡£ã€‚

```bash
mkdir docs && echo '# Hello VuePress' > docs/README.md
```

### 1.5 é…ç½® package.json

åœ¨ <code>package.json</code> ä¸­æ·»åŠ  <code>scripts</code> å­—æ®µï¼š

```json
{
  "scripts": {
    "docs:dev": "vuepress dev docs",
    "docs:build": "vuepress build docs"
  }
}
```

### 1.6 è¿è¡Œé¡¹ç›®

```bash
npm run docs:dev
```

<code>vuepress</code>ä¼šåœ¨ <code>http://localhost:8080</code> å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®å³å¯çœ‹åˆ°æ•ˆæœã€‚

### 1.7 åŸºæœ¬é…ç½®

è¦æƒ³åšå®¢å¥½çœ‹ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨ <code>docs</code> ç›®å½•ä¸‹åˆ›å»º <code>.vuepress</code> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>config.js</code> æ–‡ä»¶ï¼Œç”¨äºé…ç½®åšå®¢çš„åŸºæœ¬ä¿¡æ¯ã€‚

```js
module.exports = {
  title: "xxx",
  description: "xxx çš„ä¸ªäººåšå®¢",
  themeConfig: {
    nav: [
      { text: "Home", link: "/" },
      { text: "Guide", link: "/guide/" },
      { text: "External", link: "https://google.com" },
    ],
    sidebar: ["/", "/page-a", ["/page-b", "Explicit link text"]],
  },
}
```

ä»¥ä¸Šéƒ½å¯åœ¨[å®˜ç½‘](https://vuepress.vuejs.org/)æ‰¾åˆ°ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚

è‡³æ­¤ï¼Œç¬¬ä¸€æ­¥ç»“æŸã€‚

## 2. é…ç½® Github Pages

### 2.1 åˆ›å»º Github ä»“åº“

åœ¨ Github ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åéšä¾¿å–ä¸€ä¸ªï¼Œè¿™é‡Œä»¥<code>vuepress-blog</code> ä¸ºä¾‹ã€‚

### 2.2 ä¸æœ¬åœ°é¡¹ç›®å»ºç«‹è¿æ¥

åœ¨æœ¬åœ°é¡¹ç›®ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
git init
git add -A
git commit -m 'init'
# Github é»˜è®¤åˆ†æ”¯æ˜¯ main, å¦‚æœä½ çš„åˆ†æ”¯ä¸æ˜¯ main, åˆ™éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
git branch -M main
git remote add origin https://github.com/<Username>/<Reponame>.git
git push -u origin main
```

åœ¨è¿œç¨‹ä»“åº“ä¸ŠæŸ¥çœ‹æ˜¯å¦æäº¤æˆåŠŸã€‚

### 2.3 é…ç½® Github Pages

#### 2.3.1 åˆ›å»ºåˆ†æ”¯

åœ¨ Github ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º <code>gh-pages</code> çš„åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯ç”¨äºå­˜æ”¾åšå®¢çš„é™æ€æ–‡ä»¶ã€‚

#### 2.3.2 é…ç½® Github Pages

åœ¨ Github ä¸Šè¿›å…¥ä»“åº“çš„ <code>Settings</code> é¡µé¢ï¼Œæ‰¾åˆ° <code>Pages</code> é…ç½®é¡¹ï¼Œå°† <code>Source</code> è®¾ç½®ä¸º <code>gh-pages</code> åˆ†æ”¯ï¼Œç‚¹å‡» <code>Save</code> æŒ‰é’®ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œå°±å¯ä»¥çœ‹åˆ° <code>Your site is published at https://\<Username>.github.io/\<Reponame>/</code>ï¼Œç‚¹å‡»è¯¥é“¾æ¥å³å¯è®¿é—®åšå®¢ã€‚

### 2.4 é…ç½® Github Action

#### 2.4.1 åˆ›å»º Github Action

åœ¨ Github ä¸Šè¿›å…¥ä»“åº“çš„ <code>Actions</code> é¡µé¢ï¼Œç‚¹å‡» <code>set up a workflow yourself</code>ï¼Œè¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°ç¼–è¾‘æ¡†ä¸­ï¼Œç„¶åç‚¹å‡» <code>Start commit</code> æŒ‰é’®ï¼Œè¾“å…¥ <code>Commit message</code>ï¼Œç‚¹å‡» <code>Commit new file</code> æŒ‰é’®å³å¯ã€‚

```yml
name: Build and Deploy

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: vuepress-deploy
        uses: jenkey2011/vuepress-deploy@master
        env:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          TARGET_REPO: <Username>/<Reponame>
          TARGET_BRANCH: gh-pages
          BUILD_SCRIPT: yarn && yarn docs:build
          BUILD_DIR: docs/.vuepress/dist
```

#### 2.4.2 åˆ›å»º ACCESS_TOKEN

åœ¨ Github ä¸Šè¿›å…¥ä»“åº“çš„ <code>Settings</code> é¡µé¢ï¼Œæ‰¾åˆ° <code>Developer settings</code> é…ç½®é¡¹ï¼Œç‚¹å‡» <code>Personal access tokens</code>ï¼Œç‚¹å‡» <code>Generate new token</code>ï¼Œè¾“å…¥ <code>Note</code>ï¼Œå‹¾é€‰ <code>repo</code>ï¼Œç‚¹å‡» <code>Generate token</code>ï¼Œå°†ç”Ÿæˆçš„ <code>token</code> å¤åˆ¶ä¸‹æ¥ï¼Œç„¶ååœ¨ä»“åº“çš„ <code>Settings</code> é¡µé¢ï¼Œæ‰¾åˆ° <code>Secrets</code> é…ç½®é¡¹ï¼Œç‚¹å‡» <code>New repository secret</code>ï¼Œè¾“å…¥ <code>Name</code>ï¼ˆå°±æ˜¯ä¸Šä¸€æ­¥åˆ›å»ºçš„ yml æ–‡ä»¶ä¸­çš„ ACCESS_TOKENï¼‰ï¼Œå°† <code>token</code> ç²˜è´´åˆ° <code>Value</code> ä¸­ï¼Œç‚¹å‡» <code>Add secret</code> æŒ‰é’®å³å¯ã€‚

#### 2.4.3 æµ‹è¯• Github Action

åœ¨æœ¬åœ°é¡¹ç›®ä¸­çš„<code>main</code>åˆ†æ”¯ä¸‹ä¿®æ”¹ <code>README.md</code> æ–‡ä»¶ï¼Œç„¶åæäº¤åˆ°è¿œç¨‹ä»“åº“ï¼ŒæŸ¥çœ‹ <code>Actions</code> é¡µé¢ï¼Œæ˜¯å¦æœ‰ <code>Build and Deploy</code> çš„å·¥ä½œæµï¼Œå¦‚æœæœ‰ï¼Œç‚¹å‡»è¿›å…¥ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸï¼Œå¦‚æœæˆåŠŸï¼Œå°±å¯ä»¥åœ¨ <code>https://\<Username>.github.io/\<Reponame>/</code> çœ‹åˆ°ä¿®æ”¹åçš„æ•ˆæœäº†ã€‚

## 3. è„šæœ¬éƒ¨ç½²

åœ¨æœ¬åœ°é¡¹ç›®ä¸­çš„<code>main</code>åˆ†æ”¯ä¸‹åˆ›å»º <code>deploy.sh</code> æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/usr/bin/env sh

# ç¡®ä¿è„šæœ¬æŠ›å‡ºé‡åˆ°çš„é”™è¯¯
set -e

# ç”Ÿæˆé™æ€æ–‡ä»¶
npm run docs:build

# è¿›å…¥ç”Ÿæˆçš„æ–‡ä»¶å¤¹
cd docs/.vuepress/dist

# å¦‚æœæ˜¯å‘å¸ƒåˆ°è‡ªå®šä¹‰åŸŸå
# echo 'www.example.com' > CNAME

git add -A
git commit -m 'deploy'

# å¦‚æœå‘å¸ƒåˆ° https://<USERNAME>.github.io
# git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git master

# å¦‚æœå‘å¸ƒåˆ° https://<USERNAME>.github.io/<REPO>
git push -f git@github.com:<USERNAME>/<REPO>.git main:gh-pages

cd -
```

åœ¨<code>package.json</code>çš„<code>scripts</code>å­—æ®µä¸­æ·»åŠ <code>deploy</code>å­—æ®µæ–¹ä¾¿åç»­ç›´æ¥å‘å¸ƒã€‚

```json
{
  "scripts": {
    "docs:dev": "vuepress dev docs",
    "docs:build": "vuepress build docs",
    "deploy": "bash deploy.sh"
  }
}
```

okï¼Œè‡³æ­¤ï¼Œæœ¬åœ°å¼€å‘ç¯å¢ƒå’Œçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒéƒ½å·²ç»æ­å»ºå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„å†™åšå®¢äº†ã€‚ğŸ˜„

## é‡åˆ°çš„é—®é¢˜

å¦‚æœä½ æ˜¯æŒ‰ç…§<code>vuepress</code>å®˜ç½‘çš„<code>deploy.sh</code>éƒ¨ç½²çš„ï¼Œä¼šé‡åˆ°ï¼š

```bash
fatal: in unpopulated submodule 'docs/.vuepress/dist'
```

è§£å†³åŠæ³•æ˜¯ï¼š

```bash
git rm -rf --cached docs/.vuepress/dist
git add docs/.vuepress/dist/*
```

æäº¤ä»£ç æ—¶æŠ¥é”™ï¼š

```bash
Host key verification failed
```

è§£å†³æ–¹æ³•ï¼š

```bash
cd ~/.ssh
vi ~/.ssh/known_hosts
æ‰¾åˆ° Githubå¼€å¤´çš„é‚£ä¸€æ®µï¼Œ ç„¶åå°†é‚£ä¸€æ®µpublic key åˆ é™¤
```

---

## åç»­

### 1. è‡ªåŠ¨ç”Ÿæˆä¾§è¾¹æ 

æŒ‰ç…§å®˜ç½‘çš„é…ç½®ï¼Œæ¯æ¬¡æ·»åŠ æ–°çš„æ–‡æ¡£éƒ½éœ€è¦åœ¨<code>config.js</code>ä¸­æ‰‹åŠ¨æ·»åŠ ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥å†³å®šå®ç°è‡ªåŠ¨åŒ–ç”Ÿæˆä¾§è¾¹æ ï¼Œè¿™æ ·ä¸ä»…çœå¿ƒï¼Œè€Œä¸”çœåŠ›ã€‚

åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼š

```js
/**
   * @description: ç”Ÿæˆä¾§è¾¹æ 
   * @param {String} rpath ç›®å½•è·¯å¾„
   * @param {Array} ignoreDir å¿½ç•¥çš„ç›®å½•
   * @param {Array} suffixIncludes éœ€è¦å¤„ç†çš„æ–‡ä»¶åç¼€
   * @returns [Object] ä¾§è¾¹æ å¯¹è±¡æ•°ç»„
   * @example
   * [
   *   {
   *     title: 'æŒ‡å—',
   *     collapsable: true,
   *     children: [
   *       { title: 'å¼€å§‹', path: '/Guide/getting-started' }
   *     ]
   *   },
   * ]
   */
  genSideBarObj(rootpath, ignoreDir, suffixIncludes) {
    const sidebar = []

    function recursive(rpath, data) {
      const items = fs.readdirSync(rpath)

      items.forEach((item) => {
        const temp = path.join(rpath, item)
        const isDir = fs.statSync(temp).isDirectory()

        if (isDir && !ignoreDir.includes(item)) {
          data.push({
            title: item,
            collapsable: true,
            children: recursive(temp, []),
          })
        } else if (!isDir && suffixIncludes.includes(item.split(".")[1])) {
          if (item === "README.md" || item === "readme.md") {
            if (rootpath === rpath) return
            data.unshift({
              title: "å¼€å§‹",
              path: ``,
            })
            return
          }
          const basename = path.basename(rpath)
          const title = item.split(".")[0]
          data.push({
            title,
            path: `/${basename}/${title}`,
          })
        }
      })
      return data
    }

    recursive(rootpath, sidebar)
    return sidebar
  },
```

ä½¿ç”¨æ–¹æ³•ï¼š

```js
// åœ¨ config.js ä¸­å¼•å…¥ä¸Šè¿°æ–¹æ³•ï¼Œç„¶ååœ¨ themeConfig ä¸­é…ç½® sidebar å­—æ®µå³å¯ï¼Œä»¥ä¸‹ä¸ºç¤ºä¾‹ä»£ç ï¼š
module.exports = {
  title: "xxx",
  description: "xxx çš„ä¸ªäººåšå®¢",
  themeConfig: {
    nav: [
      { text: "Home", link: "/" },
      { text: "Guide", link: "/guide/" },
      { text: "External", link: "https://google.com" },
    ],
    sidebar: genSideBarObj(
      path.join(__dirname, "../"),
      ["node_modules", ".vuepress"],
      ["md"]
    ),
  },
}
```

### 2.æœ¬åœ°å›¾ç‰‡éƒ¨ç½²ä¸ç”Ÿæ•ˆ

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œå›¾ç‰‡å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯éƒ¨ç½²åˆ°çº¿ä¸Šåï¼Œå›¾ç‰‡å°±ä¸æ˜¾ç¤ºäº†ï¼Œè¿™æ˜¯å› ä¸º<code>vuepress</code>é»˜è®¤ä¼šå°†<code>docs/.vuepress/public</code>ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œæ‰€ä»¥åªéœ€è¦å°†å›¾ç‰‡æ”¾åˆ°è¯¥ç›®å½•ä¸‹å³å¯ã€‚

ä½¿ç”¨æ–¹å¼ï¼š

```md
<img :src="$withBase('/foo.png')" alt="foo">
```

## å‚è€ƒèµ„æ–™

- [vuepress](https://vuepress.vuejs.org/)
- [Github Pages](https://pages.github.com/)
- [Github Action](https://docs.github.com/en/actions)
- [git add å‡ºç° "fatal: in unpopulated submodule XXX" é”™è¯¯](https://zyt505050.blog.csdn.net/article/details/86693854?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-86693854-blog-121565208.235%5Ev38%5Epc_relevant_anti_vip_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-86693854-blog-121565208.235%5Ev38%5Epc_relevant_anti_vip_base&utm_relevant_index=2)
- [SSH è¿æ¥æ—¶å‡ºç° Host key verification failed çš„åŸå› åŠè§£å†³æ–¹æ³•](https://blog.csdn.net/JFENG14/article/details/128127835)
- [é™æ€èµ„æº](https://vuepress.vuejs.org/zh/guide/assets.html#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90)
